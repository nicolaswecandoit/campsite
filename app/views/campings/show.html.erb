<!--Balises SEO-->
<% set_meta_tags site: "Nomsite",
title: "#{@camping.name.titleize}",
reverse: true,
description: "#{@camping.name.titleize} : Découvrez ce camping situé dans le département #{@camping.nomdep.titleize} à #{@camping.commune.titleize} en région #{@camping.nomregion}",
canonical: "#{request.protocol}#{request.host_with_port}#{request.fullpath}"%>



<div class="col-md-8">
    
    
    
   <% if @camping.publish == false %>
        <div class="validation">Votre camping est en attente de validation pour notre équipe.</div>
        <%else %>
        <%end%>
    <h3><span class="label label-success" style="float:right;"><%= "#{@camping.etoile} étoiles" %></span></h3>
 
   
        
    <h1><%= @camping.name %></h1>
        
        
        
    <p><strong><%= @camping.code_postale %> <%= @camping.commune.mb_chars.titleize %> - <%= @camping.nomdep %></strong></p>
    
 
    
    <%if @camping.image.present? %>
    <div class="imagecamp"><%= image_tag @camping.image%></div>
    <%else%>
    <%end%>
    
    <p><h3>Description du camping:</h3></p>

    <p><% if @camping.description.empty?%>
      "Cette fiche ne contient pas de description pour le moment. Si vous êtes le propriétaire de ce camping, contactez-nous."
          <%else%>
          <div id="moretext">
          <%= simple_format(@camping.description)%>
          </div>
           <a id="showmore">voir plus</a>
        <%end %></p>

    <hr />
<!--Affichage de la map-->
      <div id="map_fiche"></div>
    <hr />

<br />
    <hr />
<h3>Caractéristiques et équipements du camping</h3>
    <!--Affiche les parametres de la table caracteristiquetest -->
    <% @camping.caracteristiquetests.each do |caracteristiquetest| %>
    <div class="col-md-4">
      <p> <%if caracteristiquetest.animaux =="oui"%><b>animaux</b><%else%><s>animaux</s><%end%></p>
      <p> <%if caracteristiquetest.television =="oui"%><b>television</b><%else%><s>television</s><%end%></p>
      </div>
      <div class="col-md-4">
      <p> <%if caracteristiquetest.handicap =="oui"%><b>handicap</b><%else%><s>handicap</s><%end%></p>
      <p> <%if caracteristiquetest.piscine =="oui"%><b>piscine</b><%else%><s>piscine</s><%end%></p>
      </div>
      <div class="col-md-4">
      <p> <%if caracteristiquetest.barbecue =="oui"%><b>barbecue</b><%else%><s>barbecue</s><%end%></p>
      <p> <%if caracteristiquetest.barbecue =="oui"%><b>barbecue</b><%else%><s>barbecue</s><%end%></p>
      </div>
    <%end%>

<hr />

<h3>Situation géographique</h3>

    <% @camping.situations.each do |situation| %>
        <div class="col-md-4">
    <p><%if situation.plage =="oui"%><b>plage à <%=situation.distanceplage%> km</b><%else%><s>plage</s><%end%></p>
    <p><%if situation.etang =="oui"%><b>etang</b><%else%><s>etang</s><%end%></p>
        </div>
        
        <div class="col-md-4">
        <p><%if situation.montagne =="oui"%><b>montagne</b><%else%><s>montagne</s><%end%></p>
        </div>
        <div class="col-md-4">
        <p><%if situation.riviere =="oui"%><b>riviere</b><%else%><s>riviere</s><%end%></p>
       </div>
      
    <%end%>

<br />

      <% if @camping.youtube_url.present? %>
    <div class="embed-container">
    <%= embed(@camping.youtube_url) %>
  </div>
    <%end%>

<% if @camping.dailymotion.present? %>
    <div class="embed-container">
<%= embedd(@camping.dailymotion) %>
</div>
<%end%>
<br />
<p><h3>Coordonnées du camping</h3></p>
<div ="col-md-8">
    <p><strong>Adresse: </strong><%= @camping.adresse.mb_chars.titleize %></p>
    <p><strong>Nomregion: </strong><%= @camping.nomregion.mb_chars.titleize %></p>
    <p><strong>Numdep: </strong><%= @camping.numdep.mb_chars.titleize %></p>
    <p><strong>Latitude: </strong><%= @camping.latitude %></p>
    <p><strong>Longitude: </strong><%= @camping.longitude %></p>
    <p><strong>Etoile :</strong><%= @camping.etoile %></p>
    <!--Affiche les parametres de la table situation-->
</div>

    <hr />

</div>

<!--Génère le fond orange dans la sidebar-->
<div class="col-md-4">
  <div class="alert alert-warning text-justify" role="alert">
    <p><strong>Courriel: </strong><%= @camping.courriel %></p>
    
        <% if @camping.site_internet.present? %>
        <%= link_to "Site internet", @camping.site_internet, :target => "_blank" %></p>
        <%else%>
        <%end%>
        
        <p><strong>Tel: </strong><%= @camping.tel %></p>
        
        <% if @camping.facebook_url.present?%>
        <%= link_to "Page Facebook", @camping.facebook_url, :target => "_blank" %>
        
        <%else%>
        <%end%>

  
  </div>



     <!--Affiche le nom du proprietaire ne fonctionne pas sans le proprietaire id -->
    <p><% if @camping.user.present? %>
        <p><h4>Votre hôte</h4></p>
        <div class="hote">
          <div class="imagehote"><%= image_tag @camping.user.avatar(:thumb), class:"imagehote" %></div>
          <div class="infohote">
          <div class ="prenomhote">
              <%= @camping.user.prenom %></div>
          
        
          
          <div class ="propriobadge"><div class="badgeverif"></div>Profil vérifié</div>

<% if current_user.present? && current_user.proprio == false %>
               <%= button_to "Contacter le propriétaire", conversations_path(conversation: { sender_id: current_user.id, recipient_id: @camping.user.id }), class:"btn btn-success" %>
          <%else%>
          <% end %>

           </div>
        </div>
        
        <%else%>
        <%end%>
    </p>


    </div>

<div class="col-md-8"> 
    <h3>Commentaires</h3>
 <div id="comments">
     
     
       
             <%if @camping.comments.present? %>
                 
                    <% @camping.comments.each do |comment| %>
                        <div class="commentglobal col-md-12">
                    
                         <div class="prenomcomment col-md-2"><p><div class="imagecomment"><%= image_tag comment.user.avatar(:thumb)%></div></p><p><%= comment.user.prenom %></p> </div>
                         
                         <p><b><%= comment.title %></b></p>
                         <p><div class="commentbody col-md-10"><%= comment.body %></div></p>
                         <div class="col-md-5">
                             
                        
                            <p>Service <span class="ratyli" data-rate="<%= comment.service %>" data-ratemax="5"></span></p>
                            <p>Communication <span class="ratyli" data-rate="<%= comment.communication %>" data-ratemax="5"></span></p>
                            <p>Qualité / prix  <span class="ratyli" data-rate="<%= comment.qualiteprix %>" data-ratemax="5"></span></p>
                        </div>
                        
                        <div class="col-md-5">
                            <p>Situation <span class="ratyli" data-rate="<%= comment.situation %>" data-ratemax="5"></span></p>
                            <p>Propreté <span class="ratyli" data-rate="<%= comment.proprete %>" data-ratemax="5"></span></p>
                            <p>Animations <span class="ratyli" data-rate="<%= comment.animation %>" data-ratemax="5"></span></p>
                        </div>
  
  
  <script>
                                 $(function() {
                                       $(".ratyli").ratyli({disable:true})({
                                              full:"<i class='fa fa-star'></i>",
                                              empty:"<i class='fa fa-star'></i>",
                                        });
                                    });
                                    
                             </script>
                             
  
                           
                         
                         <div class="datecomment"><%=comment.created_at.strftime("%B %Y")%></div>
                         </div>
                         <hr />
                         
                         <%end%>
                         
                        <% if current_user.present? && current_user.proprio == false %>
                             <%= render 'comments', camping: @camping %>
                        <%elsif current_user.present? && current_user.proprio == true %>
                            Seuls les campeurs peuvent donner leur avis.
                        <%else%>
                            Connectez-vous pour donner votre avis
                        <%end%>
                    
                     
               
             <%else%>
             Aucun commentaire sur ce camping.
             
             <% if current_user.present? && current_user.proprio == false %>
                             <%= render 'comments', camping: @camping %>
                        <%elsif current_user.present? && current_user.proprio == true %>
                            Seuls les campeurs peuvent donner leur avis.
                        <%else%>
                            <p>Créez un compte gratuit <%= link_to "ici", new_user_session_path() %> pour donner votre avis !</p>
                        <%end%>
                    
                     <%end%>
                     
   
            

    
 </div>
 </div>
 
<div class="col-md-12">    
    <!--Affiche les campings proche du camping sélectionné -->
      <% if @camping.nearbys(4).present?%>
        <h3>Les campings proches de <%=@camping.commune%></h3>
          <% for camping in @camping.nearbys(4) %>
          <%= image_tag camping.image %>
          
            <p><%= link_to camping.name, camping %> - <%= camping.distance.round(2) %> kilomètres </p>
            <%= camping.adresse%>
            <% end %>
        <%else%>
      <%end%>
    </div>
  <!--Si le proprietaire a un camping et que celui-ci est connecté alors il peut éditer -->
<%#if (user_signed_in? && (current_user.id == @camping.user_id)) %>
    <%#=  link_to "Edit", edit_camping_path(@camping) %>
  <%#else%>
      <%#end%>
      
      <%if (user_signed_in? && (current_user.proprio == true && current_user.email == @camping.courriel)) || (user_signed_in? && (current_user.proprio == true && current_user.id == @camping.user_id))%>
    <%=  link_to "Editez votre camping", edit_camping_path(@camping), class:"btnmessage" %>
  <%else%>
      <%end%>
      

<%= link_to 'Back', campings_path %>

<script src="//maps.google.com/maps/api/js?v=3.23&key=AIzaSyBHYJLTgnFqxMyLcqlOYg00RFmD6_7lLDM"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->

<script>
handler = Gmaps.build('Google');
handler.buildMap({ provider: {}, internal: {id: 'map_fiche'}}, function(){
markers = handler.addMarkers(<%=raw @hash.to_json %>);
handler.bounds.extendWith(markers);
handler.fitMapToBounds();

});
</script>
