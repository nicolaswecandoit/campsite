!function(e){e.fn.mapSearch=function(t){function n(){return{sw_lat:v.getBounds().getSouthWest().lat(),sw_lng:v.getBounds().getSouthWest().lng(),ne_lat:v.getBounds().getNorthEast().lat(),ne_lng:v.getBounds().getNorthEast().lng()}}function a(t){""!=d.request_uri&&(e(m).addClass(d.loading_class),e(d.listings_el).addClass(d.loading_class),e.get(d.request_uri+"?"+e.param(e.extend(_,t)),function(t){p(),e(d.listings_el).empty(),e.each(t[d.results_key],function(e,t){u(e,t),s(e,t)}),e(d.pagination_el).empty().prepend(g(d.page_number(t))),e("."+d.pagi_link_class).click(function(){b.page=e(this).data("href"),e.fn.mapSearch.update(b)}),d.marker_clusterer&&"function"==typeof MarkerClusterer?(f.clearMarkers(),f.addMarkers(w)):l(),e(m).removeClass(d.loading_class),e(d.listings_el).removeClass(d.loading_class)}))}function o(e,t){google.maps.event.addListener(t,"click",function(){C.setContent(e),C.open(v,t)})}function s(e,t){var n=d.listing_latlng(t),a=new google.maps.Marker({position:new google.maps.LatLng(n[0],n[1]),title:t.name,mid:e,icon:d.icon});d.marker_clusterer||a.setMap(v),o(d.infowindow_content(t),a),w.push(a)}function i(e){for(var t=0;t<w.length;t++)w[t].setMap(e)}function r(){i(null)}function l(){i(v)}function g(t){var n=t>1?'<li><a href="#" class="'+d.pagi_link_class+'" data-href="'+(t-1)+'">'+d.prev_btn_text+"</a></li>":"",a='<li><a href="#" class="'+d.pagi_link_class+'" data-href="'+(t+1)+'">'+d.next_btn_text+"</a></li>";return e(n+a).wrapAll("<ul></ul>").parent().addClass("pagination")}function c(){0!=d.filters_form&&"string"==typeof d.filters_form&&e(d.filters_form+" :input").change(function(){var t=e(d.filters_form).serializeArray(),n=[];for(var a in t)n[t[a].name]=t[a].value;e.fn.mapSearch.update(n)})}function p(){r(),w=[]}function u(t,n){var a=e(e.parseHTML(d.listing_template(n))).wrap(d.listing_wrapper).parent().attr("data-mid",t).addClass(d.listing_class).mouseenter(function(){var t=e(this).attr("data-mid");e.each(w,function(e,n){Number(n.get("mid"))===Number(t)&&n.setIcon(d.highlighted_icon)})}).mouseleave(function(){var t=e(this).attr("data-mid");e.each(w,function(e,n){Number(n.get("mid"))===Number(t)&&n.setIcon(d.icon)})});e(d.listings_el).append(a)}var m,d,_,f,h,v,C,w=[],b=[];if(m=this[0],d=e.extend({zoom:6,initialPosition:[40,-100],request_uri:"",listings_el:"#ms-listings",pagination_el:"#ms-pagination",listing_template:function(e){return'<div class="listing"><h3>'+e.name+"</h3><p><strong>Address : </strong>"+e.address+"</p><p><strong>Women owned:</strong> "+e.women+"</p><p><strong>Accept Govt Credit card:</strong> "+e.gcc+"</p></div>"},listing_wrapper:"<div></div>",page_number:function(e){return e.meta.page},listing_latlng:function(e){return[e.latlon[1],e.latlon[0]]},infowindow_content:function(e){return"<div>"+e.name+"<div>"},map_class:"ms-map",listings_class:"ms-results",listing_class:"ms-listing",pagi_link_class:"ms-pagination-button",next_btn_text:"Next",prev_btn_text:"Previous",loading_class:"loading",icon:"img/normal.png",highlighted_icon:"img/highlight.png",results_key:"results",filters_form:!1,marker_clusterer:!1,search_box:!0,searchbox_class:"form-control",searchbox_placeholder:"Search for a location"},t),e(d.listings_el).addClass(d.listings_class),e(m).addClass(d.map_class),h={center:new google.maps.LatLng(d.initialPosition[0],d.initialPosition[1]),zoom:d.zoom,streetViewControl:!1,panControl:!0,panControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},zoomControlOptions:{style:google.maps.ZoomControlStyle.LARGE,position:google.maps.ControlPosition.LEFT_BOTTOM}},v=new google.maps.Map(m,h),d.search_box)if("object"==typeof google.maps.places){e(m).prepend('<input style="top:25px !important;" type="text" id="search-form">');var x=document.getElementById("search-form");e("#search-form").addClass(d.searchbox_class).prop("placeholder",d.searchbox_placeholder),v.controls[google.maps.ControlPosition.TOP_CENTER].push(x);var k=new google.maps.places.SearchBox(x);google.maps.event.addListener(k,"places_changed",function(){var e=k.getPlaces();e.length>0&&v.panTo(e[0].geometry.location)})}else alert("Google Places library not found");C=new google.maps.InfoWindow,d.marker_clusterer&&"function"==typeof MarkerClusterer&&(f=new MarkerClusterer(v,w,{gridSize:50,maxZoom:15})),new google.maps.event.addListener(v,"idle",function(){_=n(),a(b)}),c(),e.fn.mapSearch.update=function(e){b=e,_=n(),a(b),delete b.page}}}(jQuery);